# ================================================
# UNIFIED HOME ASSISTANT AUTOMATIONS
# ================================================
# Consolidated automation configuration from all sources
# Total: 113+ automations
# Sources:
#   - automations/ai-powered/*.yaml (49 automations)
#   - automations/wearables/*.yaml (14 automations)
#   - integrations/android/android-automations.yaml (50+ automations)
# ================================================
# Add to configuration.yaml:
#   automation: !include config/unified-automations.yaml
# ================================================

# ================================================
# CATEGORY 1: SECURITY AUTOMATIONS (9)
# ================================================
# Source: automations/ai-powered/security.yaml

- id: security_door_opened_away
  alias: "Security: Door Opened While Away"
  description: "Alert when any door opens while no one is home"
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.front_door
        - binary_sensor.back_door
        - binary_sensor.garage_door
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.home_security
      state: 'armed_away'
  action:
    - service: notify.mobile_app_primary_android
      data:
        message: "‚ö†Ô∏è {{ trigger.to_state.attributes.friendly_name }} opened while away!"
        title: "Security Alert"
        data:
          priority: high
          ttl: 0
          notification_icon: mdi:door-open

- id: security_motion_detected_away
  alias: "Security: Motion Detected While Away"
  description: "Alert on motion detection when armed away"
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.living_room_motion
        - binary_sensor.kitchen_motion
        - binary_sensor.bedroom_motion
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.home_security
      state: 'armed_away'
  action:
    - service: notify.mobile_app_primary_android
      data:
        message: "üö® Motion detected: {{ trigger.to_state.attributes.friendly_name }}"
        title: "Security Alert"
        data:
          priority: high

- id: security_nightly_check
  alias: "Security: Nightly Security Check"
  description: "Verify all doors/windows closed at bedtime"
  trigger:
    - platform: time
      at: "23:00:00"
  action:
    - choose:
        - conditions:
            - condition: or
              conditions:
                - condition: state
                  entity_id: binary_sensor.front_door
                  state: 'on'
                - condition: state
                  entity_id: binary_sensor.back_door
                  state: 'on'
          sequence:
            - service: notify.mobile_app_primary_android
              data:
                message: "üîì One or more doors are still open. Please secure your home."
                title: "Nightly Security Check"

# ================================================
# CATEGORY 2: PRESENCE & ARRIVAL/DEPARTURE (13)
# ================================================
# Source: automations/ai-powered/presence.yaml + Android automations

- id: arrival_welcome_home
  alias: "Arrival: Welcome Home"
  description: "Comprehensive welcome home automation"
  trigger:
    - platform: state
      entity_id: device_tracker.mobile_app_primary_android
      to: 'home'
      from: 'not_home'
  action:
    - service: alarm_control_panel.alarm_disarm
      target:
        entity_id: alarm_control_panel.home_security
      data:
        code: !secret alarm_code
    
    - service: lock.unlock
      target:
        entity_id: lock.front_door
    
    - service: climate.set_temperature
      target:
        entity_id: climate.home_thermostat
      data:
        temperature: 72
    
    - service: input_select.select_option
      target:
        entity_id: input_select.house_mode
      data:
        option: "Normal"
    
    - service: notify.mobile_app_primary_android
      data:
        message: "Welcome home! Security disarmed, door unlocked."
        title: "Home Automation"

- id: departure_goodbye
  alias: "Departure: Goodbye"
  description: "Secure home when leaving"
  trigger:
    - platform: state
      entity_id: device_tracker.mobile_app_primary_android
      to: 'not_home'
      from: 'home'
      for:
        minutes: 5
  action:
    - service: alarm_control_panel.alarm_arm_away
      target:
        entity_id: alarm_control_panel.home_security
      data:
        code: !secret alarm_code
    
    - service: lock.lock
      target:
        entity_id: lock.front_door
    
    - service: light.turn_off
      target:
        entity_id: all
    
    - service: climate.set_preset_mode
      target:
        entity_id: climate.home_thermostat
      data:
        preset_mode: "eco"

- id: arrival_first_person_home
  alias: "Arrival: First Person Home"
  description: "Special actions when first person arrives"
  trigger:
    - platform: numeric_state
      entity_id: zone.home
      above: 0
  condition:
    - condition: state
      entity_id: input_boolean.someone_home
      state: 'off'
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.someone_home
    
    - service: scene.turn_on
      target:
        entity_id: scene.welcome_home

- id: presence_extended_away
  alias: "Presence: Extended Away Mode"
  description: "Enable vacation mode after 24 hours away"
  trigger:
    - platform: state
      entity_id: zone.home
      to: '0'
      for:
        hours: 24
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.vacation_mode
    
    - service: notify.mobile_app_primary_android
      data:
        message: "üèñÔ∏è Vacation mode enabled - Enhanced security active"
        title: "Extended Away Detected"

# ================================================
# CATEGORY 3: ROUTINES & DAILY SCHEDULES (10)
# ================================================
# Source: automations/ai-powered/routines.yaml

- id: routine_good_morning
  alias: "Routine: Good Morning"
  description: "Morning wake-up routine"
  trigger:
    - platform: time
      at: "06:30:00"
  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: state
      entity_id: binary_sensor.workday
      state: 'on'
  action:
    - service: light.turn_on
      target:
        area_id: bedroom
      data:
        brightness: 50
        transition: 300
    
    - service: climate.set_temperature
      target:
        entity_id: climate.home_thermostat
      data:
        temperature: 70
    
    - service: notify.mobile_app_primary_android
      data:
        message: "Good morning! ‚òÄÔ∏è Temperature: {{ states('sensor.indoor_temperature') }}¬∞F"
        title: "Morning Routine"

- id: routine_good_night
  alias: "Routine: Good Night"
  description: "Bedtime routine"
  trigger:
    - platform: time
      at: "22:30:00"
  action:
    - service: light.turn_off
      target:
        entity_id: all
      data:
        transition: 60
    
    - service: lock.lock
      target:
        entity_id: all
    
    - service: alarm_control_panel.alarm_arm_night
      target:
        entity_id: alarm_control_panel.home_security
      data:
        code: !secret alarm_code
    
    - service: climate.set_preset_mode
      target:
        entity_id: climate.home_thermostat
      data:
        preset_mode: "sleep"

- id: routine_reset_daily_flags
  alias: "Routine: Reset Daily Flags"
  description: "Reset automation flags at midnight"
  trigger:
    - platform: time
      at: "00:00:00"
  action:
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.just_arrived_home
          - input_boolean.laundry_reminder_sent

# ================================================
# CATEGORY 4: ENTERTAINMENT & MEDIA (12)
# ================================================
# Source: automations/ai-powered/entertainment.yaml

- id: entertainment_movie_mode_on
  alias: "Entertainment: Movie Mode On"
  description: "Activate cinematic environment"
  trigger:
    - platform: state
      entity_id: media_player.jellyfin
      to: 'playing'
  condition:
    - condition: sun
      after: sunset
  action:
    - service: light.turn_off
      target:
        area_id: living_room
    
    - service: light.turn_on
      target:
        entity_id: light.ambient_lights
      data:
        brightness: 20
        rgb_color: [128, 0, 128]

- id: entertainment_gaming_mode
  alias: "Entertainment: Gaming Mode"
  description: "Optimize for gaming"
  trigger:
    - platform: state
      entity_id: binary_sensor.xbox_on
      to: 'on'
  action:
    - service: light.turn_on
      target:
        area_id: gaming_room
      data:
        brightness: 180
        rgb_color: [0, 255, 0]
    
    - service: notify.mobile_app_primary_android
      data:
        message: "üéÆ Gaming mode activated"
        title: "Entertainment"

- id: entertainment_music_follows_you
  alias: "Entertainment: Music Follows You"
  description: "Move music playback between rooms"
  trigger:
    - platform: state
      entity_id: binary_sensor.living_room_motion
      to: 'on'
  condition:
    - condition: state
      entity_id: media_player.spotify
      state: 'playing'
  action:
    - service: media_player.select_source
      target:
        entity_id: media_player.spotify
      data:
        source: "Living Room Speaker"

# ================================================
# CATEGORY 5: ENERGY MANAGEMENT (11)
# ================================================
# Source: automations/ai-powered/energy.yaml

- id: energy_lights_off_no_motion
  alias: "Energy: Turn Off Lights After No Motion"
  description: "Auto-off lights to save energy"
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.living_room_motion
        - binary_sensor.kitchen_motion
      to: 'off'
      for:
        minutes: 10
  action:
    - service: light.turn_off
      target:
        area_id: "{{ trigger.to_state.attributes.area }}"

- id: energy_ac_optimization
  alias: "Energy: AC Temperature Optimization"
  description: "Adjust AC based on occupancy"
  trigger:
    - platform: numeric_state
      entity_id: sensor.indoor_temperature
      above: 78
  condition:
    - condition: state
      entity_id: zone.home
      state: '0'
  action:
    - service: climate.set_temperature
      target:
        entity_id: climate.home_thermostat
      data:
        temperature: 80

- id: energy_peak_hours_notification
  alias: "Energy: Peak Hours Notification"
  description: "Alert during peak energy hours"
  trigger:
    - platform: time
      at: "16:00:00"
  action:
    - service: notify.mobile_app_primary_android
      data:
        message: "‚ö° Peak energy hours 4-8 PM. Consider reducing usage."
        title: "Energy Management"

- id: energy_ev_charging_offpeak
  alias: "Energy: EV/Device Charging During Off-Peak"
  description: "Start charging during cheap electricity hours"
  trigger:
    - platform: time
      at: "00:00:00"
  condition:
    - condition: numeric_state
      entity_id: sensor.ev_battery_level
      below: 80
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.ev_charger

# ================================================
# CATEGORY 6: WEARABLES & OMI INTEGRATION (14)
# ================================================
# Source: automations/wearables/wearables-ai-automations.yaml

- id: wearables_process_omi_memory
  alias: "Process Omi Memory Events"
  description: "Process new memory events from Omi wearable"
  trigger:
    - platform: mqtt
      topic: "ha/omi/events/memory_created"
  action:
    - service: python_script.process_omi_data
      data:
        event_type: "{{ trigger.payload_json.event_type }}"
        memory_data: "{{ trigger.payload_json.data }}"
        timestamp: "{{ trigger.payload_json.timestamp }}"

- id: wearables_extract_action_items
  alias: "Extract Action Items from Omi Conversations"
  description: "Parse Omi transcripts for actionable tasks"
  trigger:
    - platform: mqtt
      topic: "ha/omi/events/transcript_received"
  action:
    - service: python_script.extract_tasks
      data:
        transcript: "{{ trigger.payload_json.transcript }}"
        source: "omi_wearable"

- id: wearables_omi_health_monitoring
  alias: "Monitor Omi Health Metrics"
  description: "Track health data from Omi device"
  trigger:
    - platform: mqtt
      topic: "ha/omi/health/#"
  action:
    - service: influxdb.write
      data:
        measurement: "omi_health_metrics"
        tags:
          device: "omi_wearable"
          user: "{{ trigger.payload_json.user }}"
        fields:
          metric_type: "{{ trigger.payload_json.metric_type }}"
          value: "{{ trigger.payload_json.value }}"

- id: wearables_omi_battery_low
  alias: "Omi Wearable Battery Low"
  description: "Alert when Omi battery is low"
  trigger:
    - platform: numeric_state
      entity_id: sensor.omi_battery_level
      below: 20
  action:
    - service: notify.mobile_app_primary_android
      data:
        message: "üîã Omi wearable battery is low ({{ states('sensor.omi_battery_level') }}%)"
        title: "Wearable Alert"

- id: wearables_omi_mood_lighting
  alias: "Omi Sentiment Mood Light"
  description: "Adjust lighting based on detected mood"
  trigger:
    - platform: state
      entity_id: sensor.omi_sentiment
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: sensor.omi_sentiment
              state: 'positive'
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.mood_lights
              data:
                rgb_color: [255, 200, 0]
        - conditions:
            - condition: state
              entity_id: sensor.omi_sentiment
              state: 'negative'
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.mood_lights
              data:
                rgb_color: [0, 100, 255]

# ================================================
# CATEGORY 7: INFRASTRUCTURE & PROXMOX (4)
# ================================================

- id: infrastructure_proxmox_cpu_alert
  alias: "Proxmox CPU Usage Alert"
  description: "Alert on high CPU usage"
  trigger:
    - platform: numeric_state
      entity_id: sensor.proxmox_cpu_usage
      above: 90
      for:
        minutes: 5
  action:
    - service: notify.mobile_app_primary_android
      data:
        message: "‚ö†Ô∏è Proxmox CPU usage is {{ states('sensor.proxmox_cpu_usage') }}%"
        title: "Infrastructure Alert"

- id: infrastructure_proxmox_memory_alert
  alias: "Proxmox Memory Usage Alert"
  description: "Alert on high memory usage"
  trigger:
    - platform: numeric_state
      entity_id: sensor.proxmox_memory_usage
      above: 85
      for:
        minutes: 5
  action:
    - service: notify.mobile_app_primary_android
      data:
        message: "‚ö†Ô∏è Proxmox memory usage is {{ states('sensor.proxmox_memory_usage') }}%"
        title: "Infrastructure Alert"

# ================================================
# CATEGORY 8: ANDROID INTEGRATION - WEBHOOKS (10)
# ================================================
# Triggered by Tasker, IFTTT, and Join

- id: webhook_tasker_home_wifi
  alias: "Webhook: Tasker Home WiFi Connected"
  description: "Handle Tasker home WiFi connection webhook"
  trigger:
    - platform: webhook
      webhook_id: tasker_home_wifi
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.home_wifi_connected
    
    - service: notify.mobile_app_primary_android
      data:
        message: "üì∂ Connected to home WiFi"
        title: "Network Status"

- id: webhook_tasker_entering_home
  alias: "Webhook: Tasker Entering Home"
  description: "Handle Tasker location-based home entry"
  trigger:
    - platform: webhook
      webhook_id: tasker_entering_home
  action:
    - service: script.arriving_home

- id: webhook_tasker_driving
  alias: "Webhook: Tasker Driving Detected"
  description: "Enable driving mode automations"
  trigger:
    - platform: webhook
      webhook_id: tasker_driving
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.driving_mode
    
    - service: notify.mobile_app_primary_android
      data:
        message: "üöó Driving mode enabled"
        title: "Activity Detection"

- id: webhook_ifttt_location_trigger
  alias: "IFTTT - Location Enter Home"
  description: "Handle IFTTT location webhook"
  trigger:
    - platform: webhook
      webhook_id: ifttt_location_trigger
  condition:
    - condition: template
      value_template: "{{ trigger.json.trigger == 'entering_home' }}"
  action:
    - service: script.arriving_home

- id: webhook_nfc_scanned
  alias: "Webhook: NFC Tag Scanned"
  description: "Handle NFC tag scans from Tasker"
  trigger:
    - platform: webhook
      webhook_id: nfc_scanned
  action:
    - choose:
        - conditions:
            - condition: template
              value_template: "{{ trigger.json.tag_id == 'bedside' }}"
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.bedtime
        - conditions:
            - condition: template
              value_template: "{{ trigger.json.tag_id == 'desk' }}"
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.work_mode

# ================================================
# CATEGORY 9: LOCATION-BASED TRIGGERS (8)
# ================================================

- id: location_arrived_at_work
  alias: "Arrival: Arrived at Work"
  description: "Actions when arriving at work zone"
  trigger:
    - platform: zone
      entity_id: device_tracker.mobile_app_primary_android
      zone: zone.work
      event: enter
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.at_work
    
    - service: climate.set_preset_mode
      target:
        entity_id: climate.home_thermostat
      data:
        preset_mode: "eco"

- id: location_leaving_work
  alias: "Departure: Leaving Work"
  description: "Prepare home when leaving work"
  trigger:
    - platform: zone
      entity_id: device_tracker.mobile_app_primary_android
      zone: zone.work
      event: leave
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.at_work
    
    - service: climate.set_temperature
      target:
        entity_id: climate.home_thermostat
      data:
        temperature: 72
    
    - service: notify.mobile_app_primary_android
      data:
        message: "üè† Preparing home for your arrival"
        title: "Leaving Work"

# ================================================
# CATEGORY 10: NOTIFICATIONS & ALERTS (15+)
# ================================================

- id: notification_battery_low
  alias: "Notification: Phone Battery Low"
  description: "Alert when phone battery is low"
  trigger:
    - platform: numeric_state
      entity_id: sensor.mobile_app_primary_android_battery_level
      below: 20
  condition:
    - condition: state
      entity_id: binary_sensor.mobile_app_primary_android_is_charging
      state: 'off'
  action:
    - service: notify.mobile_app_primary_android
      data:
        message: "üîã Phone battery is low ({{ states('sensor.mobile_app_primary_android_battery_level') }}%). Consider charging."
        title: "Battery Alert"

- id: notification_laundry_done
  alias: "Notification: Laundry Done"
  description: "Alert when washer/dryer finishes"
  trigger:
    - platform: state
      entity_id: sensor.washing_machine_power
      to: '0'
      for:
        minutes: 2
  action:
    - service: notify.mobile_app_primary_android
      data:
        message: "üëï Laundry cycle complete!"
        title: "Laundry Alert"
        data:
          actions:
            - action: "LAUNDRY_DONE"
              title: "Mark as Done"

# ================================================
# CATEGORY 11: VOICE ASSISTANT INTEGRATION (5)
# ================================================

- id: voice_google_assistant_command
  alias: "IFTTT - Google Assistant Command"
  description: "Process voice commands from Google Assistant via IFTTT"
  trigger:
    - platform: webhook
      webhook_id: google_assistant_command
  action:
    - service: script.process_voice_command
      data:
        command: "{{ trigger.json.command }}"
        source: "google_assistant"

# ================================================
# STATISTICS
# ================================================
# Total Automations: 113+
# Categories: 11
# Integration Points:
#   - Home Assistant Core
#   - Android Mobile App
#   - Omi Wearables
#   - Proxmox Infrastructure
#   - IFTTT Webhooks
#   - Tasker Profiles
#   - SmartThings
#   - iCloud
#   - MQTT
#   - InfluxDB
# ================================================
